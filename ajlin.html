document.addEventListener('DOMContentLoaded', () => {
    const addBtn = document.getElementById('add-character');
    const popupContainer = document.getElementById('popup-container');
    const charactersContainer = document.getElementById('characters-container');

    addBtn.addEventListener('click', () => {
        const popup = document.createElement('div');
        popup.style.position = 'fixed';
        popup.style.top = '50%';
        popup.style.left = '50%';
        popup.style.transform = 'translate(-50%, -50%)';
        popup.style.background = '#fbf1e6';
        popup.style.padding = '20px';
        popup.style.borderRadius = '20px';
        popup.style.boxShadow = '0 10px 20px rgba(215,155,179,0.5)';
        popup.style.maxHeight = '80vh';
        popup.style.overflowY = 'auto';
        popup.style.width = '400px';

        popup.innerHTML = `...`  // your entire form HTML goes here

        popupContainer.appendChild(popup);

        document.getElementById('cancel-btn').addEventListener('click', () => {
            popupContainer.removeChild(popup);
        });

        document.getElementById('character-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const characterData = {};
            formData.forEach((value, key) => {
                characterData[key] = value;
            });

            const card = document.createElement('div');
            card.className = 'character-card';
            let imgURL = '';
            const imgFile = formData.get('image');
            if (imgFile && imgFile.size > 0) {
                imgURL = URL.createObjectURL(imgFile);
            }

            card.innerHTML = `
                <img src="${imgURL}" alt="Character Image">
                <div class="character-name">${formData.get('name')}</div>
            `;
            charactersContainer.appendChild(card);
            popupContainer.removeChild(popup);

            card.addEventListener('click', () => {
                const detailPopup = document.createElement('div');
                detailPopup.style.position = 'fixed';
                detailPopup.style.top = '50%';
                detailPopup.style.left = '50%';
                detailPopup.style.transform = 'translate(-50%, -50%)';
                detailPopup.style.background = '#fbf1e6';
                detailPopup.style.padding = '20px';
                detailPopup.style.borderRadius = '20px';
                detailPopup.style.boxShadow = '0 10px 20px rgba(215,155,179,0.5)';
                detailPopup.style.maxHeight = '80vh';
                detailPopup.style.overflowY = 'auto';
                detailPopup.style.width = '400px';

                let detailsHTML = `<h2 style="font-family:'Allura', cursive; color:#d77fa1;">${characterData.name}</h2>`;
                for (let key in characterData) {
                    if (key !== 'image' && key !== 'name') {
                        detailsHTML += `<strong>${key.replace(/_/g, ' ')}:</strong> ${characterData[key]}<br>`;
                    }
                }
                if (imgURL) {
                    detailsHTML += `<img src="${imgURL}" style="width:100%; margin-top:10px; border-radius:15px;">`;
                }

                detailsHTML += `
                    <button id="delete-character" style="margin-top:10px; padding:10px 20px; border-radius:15px; border:none; background:#f4c2d7; font-family:'Allura', cursive; color:#6b4a3b;">ðŸ—‘ Delete</button>
                    <button id="close-detail" style="margin-top:10px; padding:10px 20px; border-radius:15px; border:none; background:#f4c2d7; font-family:'Allura', cursive; color:#6b4a3b; margin-left:10px;">Close</button>
                `;

                detailPopup.innerHTML = detailsHTML;
                popupContainer.appendChild(detailPopup);

                document.getElementById('close-detail').addEventListener('click', () => {
                    popupContainer.removeChild(detailPopup);
                });

                document.getElementById('delete-character').addEventListener('click', () => {
                    const confirmDelete = confirm("Are you sure you want to delete this character?");
                    if (confirmDelete) {
                        charactersContainer.removeChild(card);
                        popupContainer.removeChild(detailPopup);
                    }
                });
            });
        });
    });
});
